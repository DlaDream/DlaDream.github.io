---
layout:     post
title:      Linux-文件系统
date:       2020-1-12
author:     DlaDream
header-img: img/post-bg-kuaidi.jpg
tags:
     - Linux

---

## Linux-文件系统

### 文件系统概述

   把与管理文件有关的软件和数据统称为文件系统。除CPU和内存外的所有其它设备都抽象为文件。

**文件系统的作用**

- 方便的组织计算机中的所有文件，为用户提供文件的操作手段和存取控制

- 隐藏硬件设备特征，为用户和子系统提供统一的接口
  
   文件系统充当着设备管理接口的角色，用户进程的使用和操作的具体设备，都通过文件系统进行，进程只和文件系统打交道：

> 哪个硬件设备、如何提供服务都被文件系统屏蔽掉了
> 
> 具体细节由设备管理部分具体实现，并为文件管理提供尽可能简介的接口

   Linux支持不同的文件系统，Linux系统自身的文件系统为EXT2/3，它是默认的文件系统。我们把EXT2/3和Linux系统支持的文件系统统称为逻辑文件系统。

   除逻辑文件系统外，Linux还在此基础上添加了VFS(虚拟文件系统)的接口层。

![](https://i.loli.net/2019/12/14/98dxDOZcHhpwVNf.png)

  不同的文件系统之间差别很大，所以虚拟文件系统处于最上层，管理各种逻辑文件系统，屏蔽它们之间的差异，为其它部分提供访问文件和设备的统一接口。

#### 文件系统树

  在Linux中，系统可以使用不同的文件系统，但是不根据设备标识符（如：设备名称或者编号）访问，而是连接成为一个单一的文件系统树。

   Linux在挂载文件系统的时候把文件系统加到这个单一的文件系统树上。所有的文件系统，无论是什么格式都挂载到一个目录下，挂载的系统文件会掩盖被挂载点的原有文件；当挂载文件系统卸载后，原有文件又显现出来。

  磁盘初始化的时候，将物理磁盘分为一组逻辑分区，一个分区可以放置一个文件系统。

> 可以包括文件系统的设备是块设备，每一个块设备的驱动程序把对设备特定块的读写映射为对设备有意义的术语：哪个扇区、磁道和柱面等

#### 文件系统中的文件

   文件系统中文件包含了数据的集合，含文件系统内容的文件是一个ASCII文件。

- 一个文件系统不仅要保存它所包括的文件的数据，也要保存文件系统的结构

- 保存Linux系统和用户能够看到的所有信息，如：目录、文件、软连接、文件保护信息等

- 安全的保存这些信息

VFS允许同时透明的挂载许多文件系统

#### 文件管理

  Linux中的文件分为：

- 普通文件：主要是流式文件

- 目录文件：用于标识和管理系统中的文件

- 连接文件：不同目录下文件的共享

- 管道文件：提供进程间信息通讯

- 设备文件：块设备和字符设备

- 套接字：和网络通信有关



  Linux中文件为字符流无结构文件，支持顺序访问和随机访问；物理结构采用多重索引结构

![](https://i.loli.net/2019/12/18/KHVgtITAuShywQo.png)

 索引表中前12项为直接块，后三项分别为一级间接、二级间接、三级间接

##### 目录文件

  目录文件也可以用i结点进行描述。其中有两个比较特殊的目录：

- /dev：设备子目录

- /proc：系统进程子目录

**/dev**

   系统中所有的设备文件都在/dev目录下，每个设备文件也是通过i节点进行标识，但是i节点并不指向实际的物理块，而是指向设备，对设备文件的操作也就是对设备进行的操作

**/proc**

   该目录下存储当前运行系统的动态资料，属于proc逻辑文件系统，与其它文件系统不同之处为：

- proc文件并不存储在真正的块设备上

- 该目录下的文件也没有存储在设备中

  在系统初始化时，proc文件系统注册和建立i节点，但是等到真正访问该目录时，VFS才会根据内核实时信息建立文件和目录内容。

### Ext2文件系统

  Ext2文件系统将磁盘分为：

- 引导区

- 块组

  每个块组中的超级块和组描述符相同，系统启动时只用第一块组中的超级块和组描述符，其它块中的相应信息为冗杂备份，当系统故障时使用其它块中恢复这些数据。

**超级块**

   超级块用来描述目录和文件在物理设备上的分布情况，每个文件系统有自己的超级块

   超级块可以分为磁盘超级块和内存超级块

- 磁盘超级块

- 内存超级块：在启动时由磁盘超级块创建，包含有描述文件系统当前状态的动态信息和指向文件系统缓冲区的指针

**组描述符**

   描述文件系统的块组分布

### VFS虚拟文件系统

Linux中的虚拟文件系统位于整个文件系统的最上层

虚拟文件系统只存在于内存中，并没有分布在磁盘分区中，也就是说所有虚拟文件系统的内容都是系统启动后建立的，在系统关闭的时候会撤销，必须与实际文件系统一起才可以构成一个完成的文件系统

VFS采用超级块和i结点来描述文件系统，这些数据是在初始化时由真实逻辑文件系统的超级块和i结点进行填充的。

VFS的i结点用来描述虚拟文件系统的文件和目录。只存在于内存中



文件访问的实现：

1. 进程通过PCB得到文件系统的信息和指向用户打开文件表的指针

2. 用户打开相应的文件表得到指向相应的系统文件表的指针

3. 由系统文件表获得文件的打开方式、读写指针、指向文件对应的i结点以及操作函数的指针
































